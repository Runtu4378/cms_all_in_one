# cms 设计文档

## 功能描述

- 实现以站点为单位的内容管理和发布
- 站点由栏目（页面路由）组成
- 栏目对应一个路由规则，可以包含多个页面
- 页面由模板组成（页面模板）
- 页面模板由组件模板组成

```bash
站点
  |- 栏目
      |- 页面
          |- 页面模板
              |- 组件模板
```

## 功能整理

### 最低实现

- 兼容 IE8
- 实现模板组合
- 实现模板传参（编译时）
- 可视化预览
- 可视化开发
- 快速发布(页面模板在编辑时已完成编译功能，发布时只进行更迭操作)

### 高级实现

- 支持注入运行时参数

## 功能模块划分

### 内容管理系统

- 负责管理站点、栏目和栏目模板
- 站点的发布预览等功能。
- 管理栏目对应的页面模板的数据
- 能够预览栏目页面

### 模板管理系统

- 负责管理页面模板的版本
- 编辑页面模板
- 编辑组件模板
- 预览页面模板和组件模板

### 模板预览系统

- 预览模板（将数据和模板结合在一起进行展示）
- 方便嵌套（在 web 中嵌套）

### 发布系统

- 将模板进行打包或是整理（按照栏目结构整理输出）

## 用户故事

### 新建站点

新建一个示例`站点`，会有一个默认的`栏目`（站点首页），该栏目为`单页栏目`，该栏目也会绑定一个默认的`页面模板`，该模板接受一个参数 `welcomeText`，按照指引更新参数后可以触发`站点预览`。此时能够看到该页面模板生成的 helloworld 首页。

### 新建组件模板

组件模板是最小粒度的模板，是一个 `js 函数`，调用该函数时传入约定参数（组件参数，子组件列表等）即可渲染出目标静态字符串。

期待行为是该`js函数`能够封装内部变量、函数、样式。

由于本系统的特性，组件间不建议实现事件传递，需要实现复杂操作的在组件内部实现（如表单操作）。

### 新建页面模板

组件模板不对内容管理系统暴露，只有由组件模板组成的页面模板才会对外暴露。

理想情况下：

- 组件模板存在版本概念，需要主动进行封板操作才能被页面模板所选择
- 页面模板由若干组件模板组成，结构为树状结构
- 页面模板接收的参数由所组成的组件模板合并而成
- 模板管理系统负责页面模板的生成并向内容关系统暴露经过测试的页面模板

## 数据结构

### 组件模板

```javascript
{
  render: function() {}, // 渲染函数
  propsTypes: {
    key: {
      type: string, // 参数类型
      desc: string, // 参数描述
    }
  }
}
```

### 页面模板

```javascript
{
  render: function() {},  // 渲染函数
  childrens: [{
    templateId: string, // 组件模板的id
    props: {}, //组件模板的参数
  }]
}
```